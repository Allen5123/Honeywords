<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <style>
            #indexform {
                position: relative;
                top: 1em;
            }
            #subbtn {
                position: relative;
                top: 0.5em;
                left: 0.1em;
            }
        </style>
    </head>
    <body>
        <h1>HoneyWords</h1>
        <form id="indexform">
            <div id="formcontent">
                <label for="acc">Username:</label><br>
                <input id="acc" name="account" type="text" minlength="3" maxlength="20" required><br>
                <label for="pw">Password:</label><br>
                <input id="pw" name="password" type="text" minlength="6" maxlength="20" required><br>
            </div>
            <div id="subbtn">
                <input type="submit" id="signup" value="signup">
                <input type="submit" id="login" value="login">
            </div>
        </form>
        <script>
            const signupURL = 'account/signup';
            const loginURL = 'account/login';
            const form = document.getElementById('indexform');
            let Enter = async (event) => {
                event.preventDefault();
                const username = document.getElementById('acc').value;
                const password = document.getElementById('pw').value;
                const submitAction = document.activeElement.id;
                let fetchURL = (submitAction === 'login')? loginURL : signupURL;
                const result = await fetch(fetchURL, {
                    method: 'POST',
                    redirect : 'follow',
                    headers : {
                        'content-type' :ã€€'application/json'
                    },
                    body : JSON.stringify({
                        username,
                        password
                    })
                }).then((res) => {return res.json();}).catch((err)=>{console.log(err);});
                //console.log('fetch :', result);
                switch (result.status) {
                    case'VALID':
                    case'ok':
                        localStorage.setItem('token', result.data);
                        localStorage.setItem('name', username);
                        window.location.href = '/users/user';
                        break;
                    case'ATTACK':
                        window.location.href = 'users/attacker';
                        break;
                    default:
                        InvalidNotice();
                }
            }
            form.addEventListener('submit', Enter);
            let InvalidNotice = () => {
                if (document.querySelector('#notice') ===  null) {
                    const body = document.querySelector('body');
                    const notice = document.createElement('p');
                    notice.setAttribute('id', 'notice');
                    notice.textContent = 'Invalid username / password';
                    notice.style.cssText = 'color:Tomato; position: relative; top: 0.5em;';
                    body.appendChild(notice);
                }
            }
        </script>
    </body>
</html>