<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    </head>
    <body>
        <h1>HoneyWords</h1>
        <form id="indexform">
            <label for="acc">Username:</label>
            <input id="acc" name="account" type="text" minlength="3" maxlength="20" required><br>
            <label for="pw">Password:</label>
            <input id="pw" name="password" type="text" minlength="6" maxlength="20" required><br>
            <input type="submit" id="signup" value="signup">
            <input type="submit" id="login" value="login">
        </form>
        <script>
            const signupURL = 'account/signup';
            const loginURL = 'account/login';
            const form = document.getElementById('indexform');
            let Enter = async (event) => {
                event.preventDefault();
                const username = document.getElementById('acc').value;
                const password = document.getElementById('pw').value;
                const submitAction = document.activeElement.id;
                let fetchURL = (submitAction === 'login')? loginURL : signupURL;
                const result = await fetch(fetchURL, {
                    method: 'POST',
                    redirect : 'follow',
                    headers : {
                        'content-type' :ã€€'application/json'
                    },
                    body : JSON.stringify({
                        username,
                        password
                    })
                }).then((res) => {return res.json();}).catch((err)=>{console.log(err);});
                //console.log('fetch :', result);
                switch (result.status) {
                    case'VALID':
                        localStorage.setItem('token', result.data);
                        window.location.href = '/users/user';
                        break;
                    case'ATTACK':
                        window.location.href = 'users/attacker';
                        break;
                    default:
                        window.location.href = '/';
                }
            }
            form.addEventListener('submit', Enter);
        </script>
    </body>
</html>